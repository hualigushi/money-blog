Service Worker 特性

1. 不能直接访问/操作Dom
2. 需要时直接唤醒，不需要是自动休眠
3. 离线内容开发者可控
4. 一旦被安装则永远存活，除非手动卸载
5. 必须在HTTPS环境下工作，本地环境除外
6. 广泛使用Promise

![](F:\money-blog\javascript\PWA\Service Worker触发更新.JPG)



![](F:\money-blog\javascript\PWA\Service Worker更新过程.JPG)



![](F:\money-blog\javascript\PWA\Service Worker更新遇到的问题.JPG)



![](F:\money-blog\javascript\PWA\更新后通知用户.JPG)



![](F:\money-blog\javascript\PWA\更新后刷新.JPG)



# 版本控制

![](F:\money-blog\javascript\PWA\版本控制.JPG)



# 紧急状态兜底  SW_FALLBACK 控制

![](F:\money-blog\javascript\PWA\Service Worker兜底方案.JPG)







# 防止service worker作用域污染

注册之前先注销所有已注册的

```
<script>
if('serviceWorker' in navigator){
	navigator.serviceWorker.getRegistration().then((regs)=>{
	for(let teg of regs){
		reg.unregister()
	}
	})
}
</script>
```

