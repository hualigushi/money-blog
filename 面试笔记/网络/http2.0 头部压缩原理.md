## Hpack思想简介
  1. 通信的双方各拥有一本字典，记录着某些字符对应的文本内容，例如x代表危险，y代表撤退，z代表进攻等；
  2. 消息发送方根据字典生成消息文本比如'x，y'
  3. 接收方接收到消息后，根据字典还原内容：“危险，撤退”

  压缩的好处：可以在传输的过程，简化消息内容，从而降低消息的大小

  官方文档里的对Hpack的主要思想说明：

> 1. 将header里的字段列表视为可包括重复对的name-value键值对的有序集合，分别使用8位字节表示name和value
> 2. 当字段被编码/解码时，对应的字典会不断扩充
> 3. 在编码形式中，header字段可以直接表示，也可以使用header field tables 中对应的引用。因此，可以使用引用和文字值的混合来header字段列表。
> 4. 文字值要么直接编码，要么使用静态huffman代码
> 5. 编码器负责决定在标题字段表中插入哪些标题字段作为新条目。解码器执行对编码器规定的报头字段表的修改，重建处理中的报头字段列表



**HPACK要求传输过程有序，这会导致队头阻塞**



## 技术细节

### 静态表

静态表很简单，只包含已知的header字段。点此查看完整的静态表，分为两种：

  1. name和value都可以完全确定，比如:metho: GET、:status: 200
  2. 只能够确定name：比如:authority、cookie

  - 第一种情况很好理解，已知键值对直接使用一个字符表示；
  - 第二种情况稍微说明下：首先将name部分先用一个字符（比如cookie）来表示，同时，根据情况判断是否告知服务端，将 cookie: xxxxxxx 添加到动态表中（我们这里默认假定是从客户端向服务端发送消息）
  - 静态字典在首次请求中就可以使用

### 动态表

  - 动态表最初是一个空表，当每次解压头部的时候，有可能会添加条目（比如前面提到的cookie，当解压过一次cookie时，cookie: xxxxxxx就有可能被添加到动态表了，至于是否添加要根据后面提到的指令判断）
  - 动态表允许包含重复的条目，也就是可能出现完全相同的键值对
  - 为了限制解码器的需求，动态表大小有严格限制的

### 总结
同一个连接上产生的请求和响应越多，动态字典积累得越全，头部压缩效果也就越好。所以，针对 HTTP/2 网站，最佳实践是不要合并资源，不要散列域名。

默认情况下，浏览器会针对这些情况使用同一个连接：

 - 同一域名下的资源；
 - 不同域名下的资源，但是满足两个条件：1）解析到同一个 IP；2）使用同一个证书；

 使用多域名加上相同的 IP 和证书部署 Web 服务有特殊的意义：让支持 HTTP/2 的终端只建立一个连接，用上 HTTP/2 协议带来的各种好处；而只支持 HTTP/1.1 的终端则会建立多个连接，达到同时更多并发请求的目的。
