**微前端不是框架、不是工具/库，而是一套架构体系，它包括若干库、工具、中心化治理平台以及相关配套设施**。



微前端包括 3 部分：

- 微前端的基础设施。这是目前讨论得最多的，一个微应用如何通过一个组件基座加载进来、脚手架工具、怎么单独构建和部署、怎么联调。
- 微前端配置中心：标准化的配置文件格式，支持灰度、回滚、红蓝、A/B 等发布策略。
- 微前端的可观察性工具：对于任何分布式特点的架构，线上/线下治理都很重要。



微前端具体要解决好的 10 个问题：

1. 微应用的注册、异步加载和生命周期管理；
2. 微应用之间、主从之间的消息机制；
3. 微应用之间的安全隔离措施；
4. 微应用的框架无关、版本无关；
5. 微应用之间、主从之间的公共依赖的库、业务逻辑(utils)以及版本怎么管理；
6. 微应用独立调试、和主应用联调的方式，快速定位报错（发射问题）；
7. 微应用的发布流程；
8. 微应用打包优化问题；
9. 微应用专有云场景的出包方案；
10. 渐进式升级：用微应用方案平滑重构老项目。









类似于微服务之于后端，前端业务在发展到一定规模之后，也需要一种用来分解复杂度的架构模式，于是出现了*微服务思想在前端领域的应用，即微前端*。主要目的在于：

- 技术架构上进一步的扩展性（模块边界清晰、依赖明确）
- 团队组织上的自治权
- 开发流程上能独立开发、独立交付

最大的意义在于解锁了*多技术栈并存的能力*，尤其适用于渐进式重构中架构升级过渡期：



微前端的技术细节其实相对比较简单，无非就几点：

1. 样式隔离
2. window 沙箱
3. 通信机制



为了实现上面三点目标，大家使用了很多不同的机制，大概就这么几种：

1. iframe

iframe 理论上可以用来做沙箱的，无论是 js 还是 css 都可以隔离，几乎可以说什么也不用做就把一个架构理想给实现了

iframe 最大的特性就是提供了浏览器原生的硬隔离方案，不论是样式隔离、js 隔离这类问题统统都能被完美解决。

但他的最大问题也在于他的隔离性无法被突破，导致应用间上下文无法被共享，随之带来的开发体验、产品体验的问题。

缺点：

1. url 不同步。浏览器刷新 iframe url 状态丢失、后退前进按钮无法使用。
2. UI 不同步，DOM 结构不共享。想象一下屏幕右下角 1/4 的 iframe 里来一个带遮罩层的弹框，同时我们要求这个弹框要浏览器居中显示，还要浏览器 resize 时自动居中..

1. 全局上下文完全隔离，内存变量不共享。iframe 内外系统的通信、数据同步等需求，主应用的 cookie 要透传到根域名都不同的子应用中实现免登效果。

2. 慢。每次子应用进入都是一次浏览器上下文重建、资源重新加载的过程。

   

2. web-component

web component 是浏览器自带的一套 runtime，它提供 shadow dom，能够完全隔离 css

我个人认为这是最好的微前端方案，但它也有缺点：

1. 兼容问题，倒不是 ie 的兼容，而是国产浏览器很多都阉割掉了 shadow dom
2. 隔离太硬，穿透是世纪难题

上面两点，其实都不是很要紧的问题，兼容问题可以降级（polyfill），而且现在穿透隔离的方式也越来越多

与此而来的是 web component 很多优势，最主要的是它提供了一层 runtime，自带生命周期和双向绑定，可以更方便地做各种操作



**沙箱**

微前端的沙箱和其他地方的沙箱不太一样，微前端的沙箱是指的 window

大概有两种方案，一种是通过来回遍历的方式实现的「快照沙箱」，一种是使用 proxy 实现的「劫持沙箱」

更加推荐 proxy ，因为可以多个应用 new 多个 Proxy





## singlespa

实现了路由劫持和应用加载

没有实现CSS样式隔离，没有JS沙箱













