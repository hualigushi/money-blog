### MF是什么

Module Federation，中文翻译为`"模块联邦"`，是 webpack5 中的一个号称 `改变JavaScript架构的游戏规则`的功能。其文档中定义的使用目的为：

> 多个独立的构建可以形成一个应用程序。这些独立的构建不会相互依赖，因此可以单独开发和部署它们。这通常被称为微前端，但并不仅限于此。

简单说，MF 实际上就是可以把多个无单独依赖的、单独部署的应用合为一个。或者说不止是应用，MF 支持的粒度更细。它可以把多个模块、多个npm包合为一个。

### MF 的特点

1. 支持在项目中直接导出某个模块，直接单独打包。

目前，我们在跨项目/跨团队项目间复用时，主要用的方式还是以导出 npm包 为主，而npm包的抽离、发布、维护都需要一定的成本。而且当多个项目依赖同一个npm包时，若npm有升级，则所有依赖项目都要相应更新，然后重新发布。而且往往你在写某个逻辑的时候，可能并没有预想到后来有复用的可能，那么这个时候抽成npm包来复用还是比较麻烦的。

而 MF 模块是可以在项目中直接导出某个模块，单独打包的，如下图： ![GitHub](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0cfa149b31574b5385d39ca3b8ed3538~tplv-k3u1fbpfcp-zoom-1.image) 这样就很灵活，在复用逻辑的时候可以做到尽可能对现有项目少改造，快速导出。



2. 支持运行时加载，可以减少打包时的代码体积，使用起来和在同一个项目下无区别

![GitHub](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c3ec0a9af342493f8223c340c89c4c26~tplv-k3u1fbpfcp-zoom-1.image) 



因为拆分打包，所以有了更小的加载体积，而且当前子系统已经下载的chunk可以被共享，如果可以复用，下一个子系统将不会再次下载。这也就具备了可以在项目运行时同步更新不同项目间的同一模块逻辑依赖且节约了代码构建成本，维护成本等。

1. 相比过去， externals 无法多版本共存，dll 无法共享模块，MF 完美解决。
2. 借助运行时动态加载模块的特性，可以做到更好的A/B test
3. MF 可以和服务端渲染结合使用，也与 CDN 的边缘计算契合的很好，畅想一下，它还能结合 serverless 做按需编译的加载。



### MF的缺点

1. 对环境要求略高，需要使用webpack5，旧项目改造成本大。
2. 对代码封闭性高的项目，依旧需要做npm那一套管理和额外的拉取代码，还不如npm复用方便。
3. 拆分粒度需要权衡,虽然能做到依赖共享，但是被共享的lib不能做tree-shaking，也就是说如果共享了一个lodash，那么整个lodash库都会被打包到shared-chunk中。虽然依赖共享能解决传统微前端的externals的版本一致性问题。
4. webpack为了支持加载remote模块对runtime做了大量改造，在运行时要做的事情也因此陡然增加，可能会对我们页面的运行时性能造成负面影响。
5. 运行时共享也是一把双刃剑，如何去做版本控制以及控制共享模块的影响是需要去考虑的问题。
6. 远程模块 typing 的问题。





