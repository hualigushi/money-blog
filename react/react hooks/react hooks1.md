[TOC]



# 什么是 Hooks

Hooks 是一个 React 函数组件内一类特殊的函数（通常以 “use” 开头，比如 “useState”），使开发者能够在函数组件里使用 state 和 life-cycles，以及使用自定义 hook 复用业务逻辑。



# 动机

原先的 React 拥有两种创建组件的方式：函数组件 和 类组件。

函数组件就是一个传入参数返回 React 元素的 JS 函数，它没有内部 state 和生命周期，是无状态函数式组件，通常作为没有复杂交互的纯展示组件。

类组件顾名思义就是用一个 ES6 的 class 来定义的组件，它拥有 state 和完善的生命周期。

日常开发中我们可能更多的会使用类组件，因为很多情况下都不可避免地要使用 state 和生命周期。然而当使用场景越来越复杂的情况下，类组件却暴露出一些问题：

### 在组件之间重用有状态逻辑很困难

在以往，如果想要复用一段逻辑（比如：在所有页面所有组件都需要获取当前用户的身份权限，以此做一些特殊处理时），通常会使用：1. 带有这段复用逻辑的 高阶组件 2. 带有这段复用逻辑的普通组件配合上 render props(渲染属性)。但这导致的问题就是当我们的应用规模变得越来越大的时候，一些无关 UI 的 wrapper 组件越来越多，React 组件树变得越来越臃肿（在 devtool 中可以甚至看到数十层 wrapper），使开发和调试的效率变得很低。

### 按生命周期方法划分逻辑将变得难以理解

每个生命周期方法通常包含一组不相关的逻辑。例如，组件可能在 componentDidMount 和 componentDidUpdate 中执行一些数据获取。然而，相同的 componentDidMount 方法可能还包含一些不相关的逻辑，它们设置事件监听器，并在 componentWillUnmount 中执行清理。本应一起更改的相互关联的代码会被分离，完全不相关的代码最终会组合在一个方法中。这很容易引入错误和不一致，比如常常被遗忘的“取消订阅”和“取消轮询”等逻辑。

### 性能优化困难

相比于函数组件，类组件很难获得提前编译带来的好处，同时类不能很好地压缩，并且它们使得热更新加载变得片状和不可靠。



### **Hooks 的几个优点**：

- 虽然 Hooks 的目的和高阶组件、Render Props 一样，都是为了代码复用，但是 Hooks 较高阶组件和 Render Props 更为简单明了，且不会造成嵌套地狱。

- 能更容易的把 UI 和状态分离

- 一个 Hooks 中可以引用另外的 Hooks

- 解决类组件的痛点

- - `this` 指向容易错误
  - 分割在不同声明周期中的逻辑使得代码难以理解和维护
  - 代码复用成本高（高阶组件容易使代码量剧增）
  - 

# 规则

1. Hooks 命名都以 “use” 开头
2. Hooks 只能在 React 函数式组件中或另一个自定义 Hooks 中调用
3. Hooks 只能在函数顶层调用，不能在循环、条件或嵌套函数中调用（因为 React 依赖于调用 Hooks 的顺序，在条件语句中可能会打乱顺序）



